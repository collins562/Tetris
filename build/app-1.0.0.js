!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(1),i=r(o),a=n(20),u=r(a),s=n(6),c=n(21);r(c);window.onload=function(){if((0,s.isMobile)()){var e={passive:!1};document.body.style.fontSize="12px",document.documentElement.addEventListener("touchstart",function(e){e.preventDefault()},e);var t=0;document.documentElement.addEventListener("touchend",function(e){var n=Date.now();n-t<=300&&e.preventDefault(),t=n},e),document.documentElement.addEventListener("touchmove",function(e){e.preventDefault()},e)}var n=u.default.new();n.resize(),window.onresize=function(){n.resize()};i.default.instance(function(e){e.run()})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c=n(2),l=r(c),f=n(3),h=r(f),d=n(7),p=r(d),y=n(10),v=r(y),b=n(11),m=r(b),g=n(9),k=r(g),w=n(12),_=r(w),O=n(13),S=r(O),j=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"#area"));return n.blockSize=n.canvas.width/10,n.process=null,n.callbackRun=e,n.default(),n.getComponent(),n.init(),n.setupEvent(),n.__start(),n}return a(t,e),u(t,[{key:"default",value:function(){this.fps=30}},{key:"init",value:function(){this.scoreBoard.setTitle("Point"),this.scoreBoard.setNumber(0),this.clearCountBoard.setNumber(0)}},{key:"getComponent",value:function(){this.clock=p.default.new(),this.storage=m.default.new(),this.scoreBoard=k.default.new("#point span","#point p"),this.clearCountBoard=k.default.new("#cleans span","#cleans p"),this.pauseSign=v.default.new(),this.area=_.default.instance(this),this.area.init()}},{key:"setupEvent",value:function(){this.eventCtrler=h.default.instance(this)}},{key:"setPauseKeyCode",value:function(e){this.eventCtrler.setPauseKeyCode(e)}},{key:"isPaused",value:function(){return this.pauseSign.paused}},{key:"pause",value:function(){this.pauseSign.pause()}},{key:"unpause",value:function(){this.pauseSign.unpause()}},{key:"registerAction",value:function(e,t){this.eventCtrler.registerController(e,t)}},{key:"removeAllActions",value:function(){this.eventCtrler.removeAllCallbacks()}},{key:"replaceScene",value:function(e,t){this.sceneName=t,this.scene=e.new(this),this.eventCtrler.init()}},{key:"drawBlock",value:function(e,n,r){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"drawBlock",this).call(this,e,n,this.blockSize,r)}},{key:"draw",value:function(){this.scene.draw()}},{key:"update",value:function(){this.scene.update()}},{key:"runloop",value:function(){var e=this;this.draw(),this.update(),this.process=setTimeout(function(){e.runloop()},1e3/this.fps)}},{key:"run",value:function(){var e=this;this.process=setTimeout(function(){e.runloop()},1e3/this.fps)}},{key:"__start",value:function(){this.replaceScene(S.default),this.callbackRun(this)}}]),t}(l.default);t.default=j},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.canvas=document.querySelector(t),this.ctx=this.canvas.getContext("2d")}return r(e,[{key:"drawBlock",value:function(e,t,n,r){var o,i,a,u,s,c;o=n/15,i=n/10,a=this.ctx,a.fillStyle=r,s=n*e+o,c=n*t+o,u=n-2*o,a.fillRect(s,c,u,u),s+=o,c+=o,u-=2*o,a.clearRect(s,c,u,u),u-=2*i,a.fillRect(s+i,c+i,u,u)}}],[{key:"instance",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.i=this.i||new(Function.prototype.bind.apply(this,[null].concat(t))),this.i}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(4),l=r(c),f=n(5),h=n(6),d=console.log.bind(),p=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.game=e,n.pauseKeyCode=null,n.keyBinds={},n.processRawBinds(),n.setup(),n}return a(t,e),s(t,[{key:"setup",value:function(){var e=this,t=function(t,n){e.keyBinds[t].actived||(n.down(),e.keyBinds[t].actived=!0)},n=function(t,n){e.keyBinds[t].actived=!1,n.up()},r=document.querySelector("#button");this.addKBHandler(window,"keydown",f.btnDownState,t),this.addKBHandler(window,"keyup",f.btnUpState,n);var o=(0,h.isMobile)(),i=o?"touchstart":"mousedown",a="mouseout",u=o?"touchend":"mouseup";this.addMouseHandler(r,i,f.btnDownState,t),this.addMouseHandler(r,u,f.btnUpState,n),this.addMouseHandler(r,a,f.btnUpState,n)}},{key:"init",value:function(){for(var e in this.keyBinds)this.keyBinds[e]&&(this.keyBinds[e].actived=!1)}},{key:"setPauseKeyCode",value:function(e){this.pauseKeyCode=e.toString()}},{key:"processRawBinds",value:function(){var e=f.btnBindings,t={},n=!0,r=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=u(i.value,2),c=s[0],l=s[1];t[c]={component:document.querySelector(l),sceneControllers:{},actived:!1}}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}this.keyBinds=t}},{key:"registerController",value:function(e,t){var n=this.keyBinds[e],r=this.game.sceneName;n||(n=this.keyBinds[e]={sceneControllers:{},actived:!1});var o=n.sceneControllers;o[r]=t}},{key:"addKBHandler",value:function(e,t,n,r){var o=this;d("add",t,"handler of btns to",e.toString());this.game;this.addHandler(e,t,function(e){o.keyboardHandler(e,n,r)})}},{key:"keyboardHandler",value:function(e,t,n){var r=e.keyCode,o=this.game;if(r in this.keyBinds){var i=this.keyBinds[r],a=o.isPaused(),u=i.component,s=i.sceneControllers[o.sceneName];u&&(u.className=t),a&&r!=this.pauseKeyCode||!s||n(r,s)}}},{key:"addMouseHandler",value:function(e,t,n,r){var o=this;d("add",t,"handler of btns to btns"),this.addHandler(window,t,function(e){o.mouseHandler(e,n,r)})}},{key:"mouseHandler",value:function(e,t,n){var r=this.getTarget(e),o=this.game.isPaused();for(var i in this.keyBinds){var a=this.keyBinds[i],u=a.component,s=a.sceneControllers[this.game.sceneName];if(u===r&&(u.className=t,(!o||i===this.pauseKeyCode)&&s))return n(i,s)}}}]),t}(l.default);t.default=p},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e)}return r(e,[{key:"getEvent",value:function(){return event?event:window.event}},{key:"getTarget",value:function(e){return e.target||e.srcElement}},{key:"preventDefault",value:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}},{key:"stopPropagation",value:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}},{key:"addHandler",value:function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}},{key:"removeHandler",value:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=n}}],[{key:"instance",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.i=this.i||new(Function.prototype.bind.apply(this,[null].concat(t))),this.i}}]),e}();t.default=o},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=[[[0,0],[1,0],[2,0],[3,0]],[[0,0],[0,1],[1,0],[1,1]],[[0,1],[1,0],[1,1],[2,1]],[[0,0],[0,1],[1,1],[2,1]],[[0,1],[1,1],[2,0],[2,1]],[[0,0],[1,0],[1,1],[2,1]],[[0,1],[1,0],[1,1],[2,0]]],r=[[38,"#rotate_btn"],[40,"#down_btn"],[37,"#left_btn"],[39,"#right_btn"],[32,"#drop_btn"],[80,"#pause_btn"],[82,"#reset_btn"]],o="pressed",i="",a="paused",u="unpaused",s="tik",c="tok",l="rgb(135, 147, 100)",f="rgb(0, 0, 0)",h="rgb(180, 0, 0)";t.blockType=n,t.btnBindings=r,t.btnDownState=o,t.btnUpState=i,t.pauseState=a,t.unpauseState=u,t.tikState=s,t.tokState=c,t.defaultColor=l,t.occupiedColor=f,t.indicateColor=h},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n,r){return e<0||e+n[3][0]>=r.column||n.map(function(n){var o=t+n[1];return!(o<0||!r.board[o][e+n[0]].occupied)}).reduce(function(e,t){return e||t})},r=function(e,t){var n=e.map(function(e){return e[t]});return n.reduce(function(e,t){return Math.max(e,t)})-n.reduce(function(e,t){return Math.min(e,t)})},o=function(){var e=navigator.userAgent,t=/Android (\d+\.\d+)/.test(e),n=e.indexOf("iPhone")>-1,r=e.indexOf("iPod")>-1,o=e.indexOf("iPad")>-1,i=e.indexOf("NokiaN")>-1;return t||n||r||o||i};t.collide=n,t.coorDiff=r,t.isMobile=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(8),u=r(a),s=n(9),c=r(s),l=n(5),f=function(){function e(t){o(this,e),this.game=t,this.setup()}return i(e,[{key:"setup",value:function(){var e=this;this.hourBoard=c.default.new("#s_hour span"),this.minuteBoard=c.default.new("#s_minute span"),this.indicator=u.default.new("#s_clock_indi");var t=new Date;this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.hourBoard.setNumber(this.hours),this.minuteBoard.setNumber(this.minutes),setInterval(function(){e.update()},1e3)}},{key:"update",value:function(){60==++this.seconds&&(this.seconds=0,60==++this.minutes&&(this.minutes=0,24==++this.hours&&(this.hours=0),this.hourBoard.setNumber(this.hours)),this.minuteBoard.setNumber(this.minutes));var e=this.seconds%2==0?l.tikState:l.tokState;this.indicator.setState(e)}}],[{key:"new",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(this,[null].concat(t)))}}]),e}();t.default=f},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.component=document.querySelector(t)}return r(e,[{key:"setState",value:function(e){this.component.className=e}}],[{key:"new",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(this,[null].concat(t)))}}]),e}();t.default=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,r){n(this,e),this.numElts=document.querySelectorAll(t),r&&(this.titleCpn=document.querySelector(r))}return r(e,[{key:"setTitle",value:function(e){this.titleCpn.innerText=e}},{key:"getNumber",value:function(){for(var e,t,n,r=0,o=this.numElts.length-1;o>=0;o--)t=this.numElts[o].className,e=""==t?0:t[t.length-1],n=parseInt(e),isNaN(n)||(r=10*r+n);return r}},{key:"setNumber",value:function(e){for(var t,n=this.numElts.length,r=0;r<n&&e>0;r++)t=e%10,this.setDigit(t,this.numElts[r]),e=(e-t)/10;for(0==r&&(this.setDigit(0,this.numElts[0]),r++);r<n;r++)this.setDigit(null,this.numElts[r])}},{key:"setDigit",value:function(e,t){t.className=null==e?"":"n"+e}}],[{key:"new",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(this,[null].concat(t)))}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(8),c=r(s),l=n(5),f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"#s_psign"));return e.process=null,e.paused=!1,e.count=0,e}return a(t,e),u(t,[{key:"pause",value:function(){var e=this;this.paused=!0,this.process=setInterval(function(){e.count++%2==0?e.setState(l.pauseState):e.setState(l.unpauseState)},250)}},{key:"unpause",value:function(){this.paused=!1,this.count=0,this.setState(l.unpauseState),clearInterval(this.process)}}]),t}(c.default);t.default=f},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i={lastRecordKey:"tetris-last-record",maxRecordKey:"tetris-max-record"},a=function(){function e(){n(this,e),this.storage=this.getLocalStorage()}return o(e,[{key:"getLocalStorage",value:function(){return"object"==("undefined"==typeof localStorage?"undefined":r(localStorage))?localStorage:"object"==("undefined"==typeof globalStorage?"undefined":r(globalStorage))?globalStorage[location.host]:(console.warn("Local storage not available. Your record will be forgetted after leave"),{})}},{key:"getRecord",value:function(e){var t=parseInt(this.storage[e]);return isNaN(t)?0:t}},{key:"setRecord",value:function(e,t){this.storage[e]=t}},{key:"getLastRecord",value:function(){return this.getRecord(i.lastRecordKey)}},{key:"setLastRecord",value:function(e){this.setRecord(i.lastRecordKey,e)}},{key:"getMaxRecord",value:function(){return this.getRecord(i.maxRecordKey)}},{key:"setMaxRecord",value:function(e){this.setRecord(i.maxRecordKey,e)}}],[{key:"new",value:function(){return new this}}]),e}();t.default=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),a=function(){function e(t){r(this,e),this.game=t,this.board=[],this.scoring=!1,this.process=null,this.count=0,this.default()}return o(e,[{key:"default",value:function(){this.row=20,this.column=10,this.defaultColor=i.defaultColor,this.indicateColor=i.indicateColor,this.fullLinesEchoSpeed=15,this.fullLinesEchoTimes=3}},{key:"init",value:function(){for(var e=0;e<this.row;e++){this.board[e]=[];for(var t=this.board[e],n=0;n<this.column;n++)t[n]={color:this.defaultColor,occupied:!1}}}},{key:"setLine",value:function(e,t,n){for(var r=this.board[e],o=0;o<this.column;o++){var i=r[o];i.color=t,i.occupied=n}}},{key:"setUpScoreRule",value:function(e){this.scoreFunc=function(t){e.countScore(t)}}},{key:"draw",value:function(){for(var e=this.game,t=0;t<this.row;t++)for(var n=0;n<this.column;n++)e.drawBlock(n,t,this.board[t][n].color)}},{key:"update",value:function(){for(var e=[],t=0;t<this.row;t++){var n=this.board[t].map(function(e){return e.occupied}).reduce(function(e,t){return e&&t});n&&e.push(t)}e.length>0&&(this.scoring=!0,this.lines=e,this.score())}},{key:"echoFullLines",value:function(){var e=this;if(!this.game.isPaused()){if(this.count++>2*this.fullLinesEchoTimes-1)return this.count=0,this.scoring=!1,clearInterval(this.process),void this.clearFullLines();var t=this.count%2==0?this.defaultColor:this.indicateColor;this.lines.map(function(n){e.setLine(n,t,!1)})}}},{key:"clearFullLines",value:function(){var e=this,t=this.lines;t.forEach(function(t){var n=e.board.splice(t,1)[0];e.board.unshift(n)}),this.scoreFunc(t.length),this.lines=null}},{key:"score",value:function(){var e=this;this.scoring=!0,this.process=setInterval(function(){e.echoFullLines()},1e3/this.fullLinesEchoSpeed)}}],[{key:"instance",value:function(e){return this.i=this.i||new this(e),this.i}}]),e}();t.default=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(14),c=r(s),l=n(15),f=r(l),h=n(5),d=function(e){function t(e){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,e),u(t,[{key:"setup",value:function(){this.pushElement(this.game.area)}},{key:"init",value:function(){this.index=19,this.update=this.fillArea}},{key:"fillArea",value:function(){var e=this.game.area;e.setLine(this.index,h.occupiedColor,!1),--this.index<0&&(this.index=0,this.update=this.clearArea)}},{key:"clearArea",value:function(){var e=this.game.area;e.setLine(this.index,h.defaultColor,!1),20==++this.index&&this.restartGame()}},{key:"restartGame",value:function(){this.game.replaceScene(f.default,"title")}}]),t}(c.default);t.default=d},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.game=t,this.elements=[],this.setup()}return r(e,[{key:"setup",value:function(){}},{key:"init",value:function(){}},{key:"draw",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.elements[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;i.draw()}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}},{key:"update",value:function(){}},{key:"pushElement",value:function(e){this.elements.push(e)}}],[{key:"new",value:function(e){return this.i=this.i||new this(e),this.i.init(),this.i}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(14),c=r(s),l=n(16),f=r(l),h=n(19),d=r(h),p=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.title=document.querySelector("#title"),n.showGap=Math.floor(.75*e.fps),n.titleShowGap=2*e.fps,n.count=0,n.titleType=1,n}return a(t,e),u(t,[{key:"setup",value:function(){var e=this.game,t=this;e.registerAction(32,d.default.new({key:"space",once:!0,callback:function(e){t.startGame()}}))}},{key:"init",value:function(){var e=this.game;e.area.draw()}},{key:"startGame",value:function(){var e=this.game;e.replaceScene(f.default,"main"),e.init(),this.title.style.visibility="hidden"}},{key:"update",value:function(){var e=this.title,t=this.game;if(this.count%this.showGap==0){var n="visible"==e.style.visibility;e.style.visibility=n?"hidden":"visible"}if(this.count%this.titleShowGap==0){var r=t.scoreBoard,o=t.storage;this.titleType?(r.setTitle("Max"),r.setNumber(o.getMaxRecord())):(r.setTitle("Last Round"),r.setNumber(o.getLastRecord())),this.titleType=!this.titleType}this.count++}}]),t}(c.default);t.default=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(14),c=r(s),l=n(17),f=r(l),h=n(13),d=r(h),p=n(19),y=r(p),v=function(e){function t(e){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,e),u(t,[{key:"setup",value:function(){var e=this,t=this.game,n=t.area;this.eachBlockScore=10,this.bc=f.default.instance(t),this.pushElement(n),this.pushElement(this.bc),n.setUpScoreRule(this),t.registerAction(37,y.default.new({key:"left",begin:200,interval:100,callback:function(t){e.bc.moveLeft()}})),t.registerAction(39,y.default.new({key:"right",begin:200,interval:100,callback:function(t){e.bc.moveRight()}})),t.registerAction(40,y.default.new({key:"down",callback:function(t){e.bc.retired?t():e.bc.updateCD=-10}})),t.registerAction(38,y.default.new({key:"up",once:!0,callback:function(t){e.bc.rotate()}})),t.registerAction(32,y.default.new({key:"space",once:!0,callback:function(t){e.bc.drop()}})),t.registerAction(82,y.default.new({key:"r",once:!0,callback:function(t){e.resetGame()}}));var r=80;t.registerAction(r,y.default.new({key:"p",once:!0,callback:function(e){t.isPaused()?t.unpause():t.pause()}})),t.setPauseKeyCode(r)}},{key:"init",value:function(){this.bc.init()}},{key:"addScore",value:function(e){var t=this.game.scoreBoard,n=t.getNumber();t.setNumber(e+n)}},{key:"countScore",value:function(e){if(e>0){var t=this.game.clearCountBoard,n=t.getNumber();t.setNumber(e+n);for(var r=0;e>0;e--)r+=e;this.addScore(100*r)}}},{key:"resetGame",value:function(){var e=this.game;e.replaceScene(d.default,"Reset");var t=e.storage,n=t.getMaxRecord(),r=e.scoreBoard.getNumber();r>n&&t.setMaxRecord(r),t.setLastRecord(r)}},{key:"update",value:function(){var e=this.bc,t=this.game,n=t.area;t.isPaused()||n.scoring||(e.retired?e.y<0?this.resetGame():(e.occupy(),this.addScore(this.eachBlockScore),n.update(),e.init()):e.update())}}]),t}(c.default);t.default=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(18),u=r(a),s=n(6),c=n(5),l=function(){function e(t){o(this,e),this.game=t,this.default(),this.setup()}return i(e,[{key:"default",value:function(){this.defaultColor=c.occupiedColor,this.indicateColor=c.indicateColor,this.maxUpdateCD=Math.floor(this.game.fps/1.5)}},{key:"setup",value:function(){this.preview=u.default.instance(this.game),this.preview.next()}},{key:"init",value:function(){var e=this.preview;this.coors=e.coors,e.next(),e.clear(),e.draw(),this.x=3,this.y=-(0,s.coorDiff)(this.coors,1)-1,this.color=this.defaultColor,this.updateCD=this.maxUpdateCD,this.retired=!1}},{key:"move",value:function(e){if(!this.retired){var t=this.game.area;(0,s.collide)(this.x+e,this.y,this.coors,t)||(this.x+=e)}}},{key:"moveLeft",value:function(){this.move(-1)}},{key:"moveRight",value:function(){this.move(1)}},{key:"rotate",value:function(){if(!this.retired){var e=this.rotateCoors(this.coors),t=this.game.area;(0,s.collide)(this.x,this.y,e,t)||(this.coors=e)}}},{key:"rotateCoors",value:function(e){var t=e.map(function(e){return[-e[1],e[0]]}),n=t.sort(function(e,t){return e[0]==t[0]?e[1]-t[1]:e[0]-t[0]})[0];return t.map(function(e){return[e[0]-n[0],e[1]-n[1]]})}},{key:"drop",value:function(){if(!this.game.area.scoring)for(;!this.retired;)this.updateY()}},{key:"occupy",value:function(){var e=this.game.area.board,t=!0,n=!1,r=void 0;try{for(var o,i=this.coors[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;try{var u=e[this.y+a[1]][this.x+a[0]];u.occupied=!0,u.color=this.defaultColor}catch(e){}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}},{key:"retire",value:function(){this.retired=!0,this.color=this.indicateColor}},{key:"isBlocked",value:function(){var e=this.game.area,t=!0,n=!1,r=void 0;try{for(var o,i=this.coors[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;try{if(this.y+a[1]+1==e.row||e.board[this.y+a[1]+1][this.x+a[0]].occupied)return!0}catch(e){}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}return!1}},{key:"draw",value:function(){var e=this.game,t=!0,n=!1,r=void 0;try{for(var o,i=this.coors[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;e.drawBlock(this.x+a[0],this.y+a[1],this.color)}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}},{key:"updateY",value:function(){this.isBlocked()?this.retire():this.y++}},{key:"update",value:function(){this.updateCD<=0?(this.updateCD=this.maxUpdateCD,this.updateY()):this.updateCD--}}],[{key:"instance",value:function(e){return this.i=this.i||new this(e),this.i}}]),e}();t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c=n(2),l=r(c),f=n(5),h=n(6),d=function(e){function t(e){
o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"#next canvas"));return n.game=e,n.default(),n}return a(t,e),u(t,[{key:"next",value:function(){this.coors=this.randBlockType();var e=(0,h.coorDiff)(this.coors,0);this.offsetX=1==e?1:2==e?.5:0,this.offsetY=0==(0,h.coorDiff)(this.coors,1)?.5:0}},{key:"default",value:function(){this.color=f.occupiedColor}},{key:"drawBlock",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"drawBlock",this).call(this,e,n,this.game.blockSize,this.color)}},{key:"randBlockType",value:function(){var e=f.blockType;return e[Math.floor(Math.random()*e.length)]}},{key:"draw",value:function(){var e=this.coors,t=this.offsetX,n=this.offsetY,r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;this.drawBlock(s[0]+t,s[1]+n)}}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}},{key:"clear",value:function(){var e=this.canvas;this.ctx.clearRect(0,0,e.width,e.height)}}]),t}(l.default);t.default=d},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o={},i=function(){function e(t){n(this,e),this.key=t.key,this.callback=t.callback,this.begin=t.begin||100,this.interval=t.interval||50,this.once=t.once}return r(e,[{key:"down",value:function(){var e=this;this.clearAll(),this.callback(function(){e.up()}),this.once!==!0&&(this.start=this.begin,this.loop())}},{key:"up",value:function(){clearTimeout(o[this.key]),o[this.key]=null}},{key:"loop",value:function(){var e=this;o[this.key]=setTimeout(function(){e.start=null,e.loop(),e.callback(function(){return e.up()})},this.start||this.interval)}},{key:"clearAll",value:function(){for(var e in o){var t=o[e];t&&(clearTimeout(o[e]),o[e]=null)}}}],[{key:"new",value:function(e){return new this(e)}}]),e}();t.default=i},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e),this.root=document.querySelector("#root"),this.game=document.querySelector("#game"),this.button=document.querySelector("#button"),this.curW=440,this.curH=677,this.aspectRatio=this.curW/this.curH,this.process=null}return r(e,[{key:"getBrowserInterfaceSize",value:function(){var e=window.innerWidth,t=window.innerHeight;return"number"!=typeof e&&("CSS1Compat"==document.compatMode?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(e=document.body.clientWidth,t=window.body.clientHeight)),{pageWidth:e,pageHeight:t}}},{key:"resize",value:function(){var e,t,n,r,o,i,a,u;if(e=this.root,t=this.game,n=this.button,i=this.getBrowserInterfaceSize(),r=i.pageWidth,o=i.pageHeight,o!=this.curH){var s,c,l;a=o/677,s=a-1,u="scale("+a+")",c=440*a,(o<this.curH&&c<this.curW||o>this.curH||c>this.curW)&&(e.style.width=c+"px",this.curW=c,l=220*s,t.style.transform="scale("+a+")",n.style.transform="scale("+a+")",t.style.marginLeft=l+50+"px",n.style.marginLeft=l+"px"),t.style.marginTop=200*s+30*a+"px",n.style.marginTop=225*s+"px",this.process=null,this.curH=o}if(r<this.curH*this.aspectRatio){if(e.style.width="100%",r==this.curW)return;a=r/440,s=a-1,u="scale("+a+")",t.style.transform=n.style.transform=u,t.style.marginLeft=220*s+50+"px",n.style.marginLeft=220*s+"px",this.curW=r}else e.style.width=o*this.aspectRatio+"px"}}],[{key:"new",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(this,[null].concat(t)))}}]),e}();t.default=o},function(e,t){}]);
//# sourceMappingURL=app-1.0.0.js.map